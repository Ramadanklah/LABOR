import{r as e,a as s,R as t}from"./vendor-DtX1tuCI.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var r={exports:{}},a={},i=e,n=Symbol.for("react.element"),o=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,d=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function m(e,s,t){var r,a={},i=null,o=null;for(r in void 0!==t&&(i=""+t),void 0!==s.key&&(i=""+s.key),void 0!==s.ref&&(o=s.ref),s)l.call(s,r)&&!c.hasOwnProperty(r)&&(a[r]=s[r]);if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===a[r]&&(a[r]=s[r]);return{$$typeof:n,type:e,key:i,ref:o,props:a,_owner:d.current}}a.Fragment=o,a.jsx=m,a.jsxs=m,r.exports=a;var u=r.exports,x={},h=s;x.createRoot=h.createRoot,x.hydrateRoot=h.hydrateRoot;const g=new class{constructor(){this.baseURL="/api",this.cache=new Map,this.requestInterceptors=[],this.responseInterceptors=[],this.defaultOptions={headers:{"Content-Type":"application/json"}}}addRequestInterceptor(e){this.requestInterceptors.push(e)}addResponseInterceptor(e){this.responseInterceptors.push(e)}async applyRequestInterceptors(e,s){let t={...s};for(const r of this.requestInterceptors)t=await r(e,t);return t}async applyResponseInterceptors(e){let s=e;for(const t of this.responseInterceptors)s=await t(s);return s}getCacheKey(e,s){return`${s.method||"GET"}-${e}-${JSON.stringify(s.body||{})}`}async retry(e,s=3,t=1e3){try{return await e()}catch(r){if(s>0&&r.status>=500)return await new Promise(e=>setTimeout(e,t)),this.retry(e,s-1,2*t);throw r}}async request(e,s={}){const t=`${this.baseURL}${e}`,r={...this.defaultOptions,...s,headers:{...this.defaultOptions.headers,...s.headers}},a=await this.applyRequestInterceptors(t,r),i=this.getCacheKey(t,a);if("GET"===a.method||!a.method){const e=this.cache.get(i);if(e&&Date.now()-e.timestamp<(a.cacheTimeout||3e5))return e.data}const n=await this.retry(async()=>{const e=await fetch(t,a);if(!e.ok){const s=new Error(`HTTP error! status: ${e.status}`);throw s.status=e.status,s.response=e,s}return e}),o=await this.applyResponseInterceptors(n);let l;const d=o.headers.get("content-type");return l=(null==d?void 0:d.includes("application/json"))?await o.json():await o.text(),"GET"!==a.method&&a.method||this.cache.set(i,{data:l,timestamp:Date.now()}),l}get(e,s={}){return this.request(e,{...s,method:"GET"})}post(e,s,t={}){return this.request(e,{...t,method:"POST",body:JSON.stringify(s)})}put(e,s,t={}){return this.request(e,{...t,method:"PUT",body:JSON.stringify(s)})}delete(e,s={}){return this.request(e,{...s,method:"DELETE"})}async download(e,s={}){const t=`${this.baseURL}${e}`,r=await this.applyRequestInterceptors(t,{...this.defaultOptions,...s}),a=await fetch(t,r);if(!a.ok){const e=new Error(`Download failed: ${a.status}`);throw e.status=a.status,e}return a}clearCache(){this.cache.clear()}clearCacheEntry(e,s={}){const t=this.getCacheKey(`${this.baseURL}${e}`,s);this.cache.delete(t)}};function p({onLoginSuccess:s,onError:t}){const[r,a]=e.useState("email"),[i,n]=e.useState(""),[o,l]=e.useState(""),[d,c]=e.useState(""),[m,x]=e.useState(""),[h,p]=e.useState(""),[f,b]=e.useState(""),[y,v]=e.useState(!1);return u.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 py-12 px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"max-w-md w-full space-y-8",children:[u.jsxs("div",{children:[u.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-indigo-100",children:u.jsx("svg",{className:"h-6 w-6 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),u.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Laboratory Results System"}),u.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to access your laboratory results"})]}),u.jsx("form",{className:"mt-8 space-y-6",onSubmit:async e=>{e.preventDefault(),b(""),v(!0);try{const e={password:m,..."email"===r?{email:i}:{bsnr:o,lanr:d},...h?{otp:h}:{}},t=await g.post("/auth/login",e);t.success?(b(t.message),localStorage.setItem("authToken",t.token),localStorage.setItem("userInfo",JSON.stringify(t.user)),s&&s(t.token,t.user)):b(t.message||"Login failed")}catch(a){const e=a.message||"Network error or server unavailable";b(e),t&&t(new Error(e))}finally{v(!1)}},children:u.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Login Method"}),u.jsxs("div",{className:"flex space-x-4",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"radio",name:"loginMethod",value:"email",checked:"email"===r,onChange:e=>a(e.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),u.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Email"})]}),u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"radio",name:"loginMethod",value:"bsnr",checked:"bsnr"===r,onChange:e=>a(e.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),u.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"BSNR/LANR"})]})]})]}),"email"===r?u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),u.jsx("input",{type:"email",id:"email",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md py-2 px-3",value:i,onChange:e=>n(e.target.value),required:"email"===r,placeholder:"Enter your email address"})]}):u.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"bsnr",className:"block text-sm font-medium text-gray-700 mb-2",children:"BSNR"}),u.jsx("input",{type:"text",id:"bsnr",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md py-2 px-3",value:o,onChange:e=>l(e.target.value),required:"bsnr"===r,placeholder:"BSNR"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"lanr",className:"block text-sm font-medium text-gray-700 mb-2",children:"LANR"}),u.jsx("input",{type:"text",id:"lanr",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md py-2 px-3",value:d,onChange:e=>c(e.target.value),required:"bsnr"===r,placeholder:"LANR"})]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),u.jsx("input",{type:"password",id:"password",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md py-2 px-3",value:m,onChange:e=>x(e.target.value),required:!0,placeholder:"Enter your password"})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{htmlFor:"otp",className:"block text-sm font-medium text-gray-700 mb-2",children:"2-Factor Code (if enabled)"}),u.jsx("input",{type:"text",id:"otp",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md py-2 px-3",value:h,onChange:e=>p(e.target.value),placeholder:"123456"})]}),u.jsx("button",{type:"submit",disabled:y,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-150",children:y?u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing in..."]}):"Sign in"}),f&&u.jsx("div",{className:"mt-4 p-3 rounded-md text-sm "+(f.includes("successful")||f.includes("Login successful")?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:f})]})}),!1,u.jsxs("div",{className:"text-center",children:[u.jsx("p",{className:"text-xs text-gray-500",children:"Laboratory Results Management System"}),u.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Secure access to medical laboratory data"})]})]})})}g.addRequestInterceptor(async(e,s)=>{const t=localStorage.getItem("authToken");return t&&(s.headers.Authorization=`Bearer ${t}`),s}),g.addResponseInterceptor(async e=>(401===e.status&&(localStorage.removeItem("authToken"),window.location.href="/login"),e));const f=t.memo(({status:s})=>{const t=e.useMemo(()=>{switch(s){case"Final":return"bg-green-100 text-green-800";case"Preliminary":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},[s]);return u.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t}`,children:s})}),b=t.memo(({result:e,onDownload:s,downloading:t})=>u.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.id}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.date}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.type}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx(f,{status:e.status})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.patient}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("button",{onClick:()=>s("ldt",e.id),disabled:t,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150",children:t?"Downloading...":"LDT"}),u.jsx("button",{onClick:()=>s("pdf",e.id),disabled:t,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150",children:t?"Downloading...":"PDF"})]})})]}));const y=t.memo(function({token:s,onLogout:t}){const[r,a]=e.useState([]),[i,n]=e.useState(!0),[o,l]=e.useState(""),[d,c]=e.useState(""),[m,x]=e.useState(""),[h,g]=e.useState(""),[p,f]=e.useState(!1),[y,v]=e.useState(1),[j]=e.useState(20),w=e.useMemo(()=>{let e=Array.isArray(r)?r:[];if(o){const s=o.toLowerCase();e=e.filter(e=>e.patient.toLowerCase().includes(s)||e.id.toLowerCase().includes(s)||e.type.toLowerCase().includes(s))}return d&&(e=e.filter(e=>e.status===d)),m&&(e=e.filter(e=>e.type===m)),e},[r,o,d,m]),N=e.useMemo(()=>{const e=(y-1)*j,s=e+j;return w.slice(e,s)},[w,y,j]),k=e.useMemo(()=>Math.ceil(w.length/j),[w.length,j]),C=e.useMemo(()=>[...new Set(r.map(e=>e.status))],[r]),S=e.useMemo(()=>[...new Set(r.map(e=>e.type))],[r]),L=e.useCallback(async()=>{try{n(!0);const e=await fetch("/api/results",{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);{const s=await e.json();a(s.results||[]),g("")}}catch(e){g(e.message||"Network error or server unavailable")}finally{n(!1)}},[s]);e.useEffect(()=>{L()},[L]),e.useEffect(()=>{v(1)},[o,d,m]);const R=e.useCallback(async(e,t=null)=>{var r;try{f(!0);const a=t?`/api/download/${e}/${t}`:`/api/download/${e}`,i=await fetch(a,{headers:{Authorization:`Bearer ${s}`}});if(!i.ok)throw new Error(`Download failed: ${i.statusText}`);const n=await i.blob(),o=window.URL.createObjectURL(n),l=document.createElement("a");l.href=o;const d=i.headers.get("content-disposition"),c=d?null==(r=d.split("filename=")[1])?void 0:r.replace(/"/g,""):`lab_results_${t||"all"}_${(new Date).toISOString().slice(0,10)}.${e}`;l.download=c,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o)}catch(a){g(`Download failed: ${a.message}`)}finally{f(!1)}},[s]);return h?u.jsx("div",{className:"min-h-screen bg-gray-100 py-6 flex flex-col justify-center sm:py-12",children:u.jsx("div",{className:"relative py-3 sm:max-w-xl sm:mx-auto",children:u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:u.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),u.jsxs("div",{className:"ml-3",children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),u.jsx("div",{className:"mt-2 text-sm text-red-700",children:u.jsx("p",{children:h})}),u.jsx("div",{className:"mt-4",children:u.jsx("button",{onClick:()=>{g(""),L()},className:"bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded transition-colors duration-150",children:"Retry"})})]})]})})})}):u.jsxs("div",{className:"min-h-screen bg-gray-100",children:[u.jsx("div",{className:"bg-white shadow",children:u.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center py-6",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold leading-tight text-gray-900",children:"Laboratory Results Dashboard"}),u.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Showing ",w.length," of ",r.length," results"]})]}),u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsx("button",{onClick:()=>R("ldt"),disabled:p||0===r.length,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150",children:p?"Downloading...":"Download All LDT"}),u.jsx("button",{onClick:()=>R("pdf"),disabled:p||0===r.length,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150",children:p?"Downloading...":"Download All PDF"}),u.jsx("button",{onClick:t,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-150",children:"Logout"})]})]})})}),u.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:u.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:u.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),u.jsx("input",{type:"text",id:"search",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-150",placeholder:"Search by patient name or result ID...",value:o,onChange:e=>l(e.target.value)})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),u.jsxs("select",{id:"status",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-150",value:d,onChange:e=>c(e.target.value),children:[u.jsx("option",{value:"",children:"All Statuses"}),C.map(e=>u.jsx("option",{value:e,children:e},e))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),u.jsxs("select",{id:"type",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-150",value:m,onChange:e=>x(e.target.value),children:[u.jsx("option",{value:"",children:"All Types"}),S.map(e=>u.jsx("option",{value:e,children:e},e))]})]})]})})}),u.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-6",children:u.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:i?u.jsx("div",{className:"flex items-center justify-center h-64",children:u.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[u.jsx("thead",{className:"bg-gray-50",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Result ID"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),u.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(e=>u.jsx(b,{result:e,onDownload:R,downloading:p},e.id))})]})}),k>1&&u.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[u.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[u.jsx("button",{onClick:()=>v(Math.max(1,y-1)),disabled:1===y,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),u.jsx("button",{onClick:()=>v(Math.min(k,y+1)),disabled:y===k,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),u.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[u.jsx("div",{children:u.jsxs("p",{className:"text-sm text-gray-700",children:["Showing"," ",u.jsx("span",{className:"font-medium",children:(y-1)*j+1})," ","to"," ",u.jsx("span",{className:"font-medium",children:Math.min(y*j,w.length)})," ","of"," ",u.jsx("span",{className:"font-medium",children:w.length})," ","results"]})}),u.jsx("div",{children:u.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[u.jsx("button",{onClick:()=>v(Math.max(1,y-1)),disabled:1===y,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),Array.from({length:Math.min(5,k)},(e,s)=>{const t=Math.max(1,Math.min(k-4,y-2))+s;return u.jsx("button",{onClick:()=>v(t),className:"relative inline-flex items-center px-4 py-2 border text-sm font-medium "+(t===y?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:t},t)}),u.jsx("button",{onClick:()=>v(Math.min(k,y+1)),disabled:y===k,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})})]})]})]})})})]})}),v=({currentUser:s})=>{const[t,r]=e.useState([]),[a,i]=e.useState(!0),[n,o]=e.useState(""),[l,d]=e.useState(!1),[c,m]=e.useState(!1),[x,h]=e.useState(null),[p,f]=e.useState({search:"",role:"",isActive:""}),[b,y]=e.useState(null),[v,N]=e.useState([]),k=e.useCallback(async()=>{try{i(!0);const e=await g.get("/users",{params:p});e.success&&(r(e.users),y(e.stats),o(""))}catch(e){o("Failed to fetch users")}finally{i(!1)}},[p]),C=e.useCallback(async()=>{try{const e=await g.get("/roles");e.success&&N(e.roles)}catch(e){}},[]);e.useEffect(()=>{k(),C()},[k,C]);const S=e.useMemo(()=>(Array.isArray(t)?t:[]).filter(e=>{const s=!p.search||e.firstName.toLowerCase().includes(p.search.toLowerCase())||e.lastName.toLowerCase().includes(p.search.toLowerCase())||e.email.toLowerCase().includes(p.search.toLowerCase())||e.bsnr&&e.bsnr.includes(p.search)||e.lanr&&e.lanr.includes(p.search),t=!p.role||e.role===p.role,r=""===p.isActive||e.isActive.toString()===p.isActive;return s&&t&&r}),[t,p]),L=e=>{const s=v.find(s=>s.value===e);return s?s.key.replace("_"," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase()):e},R=e=>{switch(e){case"admin":return"bg-purple-100 text-purple-800";case"doctor":return"bg-blue-100 text-blue-800";case"lab_technician":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return a?u.jsx("div",{className:"flex items-center justify-center h-64",children:u.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})}):u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),u.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage users, roles, and permissions across the system"})]}),u.jsx("div",{className:"mt-4 sm:mt-0",children:u.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[u.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add User"]})})]}),b&&u.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[u.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:u.jsx("div",{className:"p-5",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),u.jsx("div",{className:"ml-5 w-0 flex-1",children:u.jsxs("dl",{children:[u.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Users"}),u.jsx("dd",{className:"text-lg font-medium text-gray-900",children:b.total})]})})]})})}),u.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:u.jsx("div",{className:"p-5",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-6 w-6 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),u.jsx("div",{className:"ml-5 w-0 flex-1",children:u.jsxs("dl",{children:[u.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Active Users"}),u.jsx("dd",{className:"text-lg font-medium text-gray-900",children:b.active})]})})]})})}),u.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:u.jsx("div",{className:"p-5",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-6 w-6 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),u.jsx("div",{className:"ml-5 w-0 flex-1",children:u.jsxs("dl",{children:[u.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Doctors"}),u.jsx("dd",{className:"text-lg font-medium text-gray-900",children:b.byRole.doctor})]})})]})})}),u.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:u.jsx("div",{className:"p-5",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-6 w-6 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m14-6h2m-2 6h2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})})}),u.jsx("div",{className:"ml-5 w-0 flex-1",children:u.jsxs("dl",{children:[u.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Lab Technicians"}),u.jsx("dd",{className:"text-lg font-medium text-gray-900",children:b.byRole.lab_technician})]})})]})})})]}),u.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Filters"}),u.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),u.jsx("input",{type:"text",id:"search",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"Search by name, email, BSNR, LANR...",value:p.search,onChange:e=>f({...p,search:e.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),u.jsxs("select",{id:"role",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",value:p.role,onChange:e=>f({...p,role:e.target.value}),children:[u.jsx("option",{value:"",children:"All Roles"}),v.map(e=>u.jsx("option",{value:e.value,children:L(e.value)},e.value))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),u.jsxs("select",{id:"status",className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",value:p.isActive,onChange:e=>f({...p,isActive:e.target.value}),children:[u.jsx("option",{value:"",children:"All Status"}),u.jsx("option",{value:"true",children:"Active"}),u.jsx("option",{value:"false",children:"Inactive"})]})]})]})]}),n&&u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:u.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),u.jsx("div",{className:"ml-3",children:u.jsx("p",{className:"text-sm text-red-800",children:n})})]})}),u.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:u.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Users (",S.length,")"]}),u.jsxs("button",{onClick:k,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[u.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[u.jsx("thead",{className:"bg-gray-50",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"BSNR/LANR"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Login"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),u.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(e=>u.jsxs("tr",{className:"hover:bg-gray-50",children:[u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:u.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:u.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[e.firstName.charAt(0),e.lastName.charAt(0)]})})}),u.jsxs("div",{className:"ml-4",children:[u.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),u.jsx("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R(e.role)}`,children:L(e.role)})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.bsnr&&e.lanr?`${e.bsnr} / ${e.lanr}`:"-"}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.lastLogin?new Date(e.lastLogin).toLocaleDateString():"Never"}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("button",{onClick:()=>{h(e),m(!0)},className:"text-indigo-600 hover:text-indigo-900",children:"Edit"}),u.jsx("button",{onClick:()=>(async(e,s)=>{try{(await g.put(`/users/${e}`,{isActive:!s})).success&&r(t.map(t=>t.id===e?{...t,isActive:!s}:t))}catch(a){alert("Failed to update user status: "+a.message)}})(e.id,e.isActive),className:e.isActive?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900",children:e.isActive?"Deactivate":"Activate"}),e.id!==s.id&&u.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this user? This action cannot be undone."))try{(await g.delete(`/users/${e}`)).success&&(r(t.filter(s=>s.id!==e)),alert("User deleted successfully"))}catch(s){alert("Failed to delete user: "+s.message)}})(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})})]},e.id))})]})}),0===S.length&&u.jsx("div",{className:"text-center py-8",children:u.jsx("p",{className:"text-gray-500",children:"No users found matching your criteria."})})]})}),l&&u.jsx(j,{isOpen:l,onClose:()=>d(!1),onUserCreated:e=>{r([...t,e]),d(!1)},roles:v}),c&&x&&u.jsx(w,{isOpen:c,user:x,onClose:()=>{m(!1),h(null)},onUserUpdated:e=>{r(t.map(s=>s.id===e.id?e:s)),m(!1),h(null)},roles:v})]})},j=({isOpen:s,onClose:t,onUserCreated:r,roles:a})=>{const[i,n]=e.useState({firstName:"",lastName:"",email:"",password:"",role:"doctor",bsnr:"",lanr:"",specialization:"",department:"",isActive:!0}),[o,l]=e.useState(!1),[d,c]=e.useState("");return s?u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:u.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:u.jsxs("div",{className:"mt-3",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New User"}),d&&u.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-3",children:u.jsx("p",{className:"text-sm text-red-800",children:d})}),u.jsxs("form",{onSubmit:async e=>{e.preventDefault(),l(!0),c("");try{const e=await g.post("/users",i);e.success&&(r(e.user),n({firstName:"",lastName:"",email:"",password:"",role:"doctor",bsnr:"",lanr:"",specialization:"",department:"",isActive:!0}))}catch(s){c(s.message)}finally{l(!1)}},className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),u.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:i.firstName,onChange:e=>n({...i,firstName:e.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),u.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:i.lastName,onChange:e=>n({...i,lastName:e.target.value})})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),u.jsx("input",{type:"email",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:i.email,onChange:e=>n({...i,email:e.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),u.jsx("input",{type:"password",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:i.password,onChange:e=>n({...i,password:e.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),u.jsx("select",{required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:i.role,onChange:e=>n({...i,role:e.target.value}),children:a.map(e=>u.jsx("option",{value:e.value,children:e.key.replace("_"," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())},e.value))})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"BSNR"}),u.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:i.bsnr,onChange:e=>n({...i,bsnr:e.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"LANR"}),u.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:i.lanr,onChange:e=>n({...i,lanr:e.target.value})})]})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:i.isActive,onChange:e=>n({...i,isActive:e.target.checked})}),u.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"Active User"})]}),u.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[u.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),u.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:o?"Creating...":"Create User"})]})]})]})})}):null},w=({isOpen:s,user:t,onClose:r,onUserUpdated:a,roles:i})=>{const[n,o]=e.useState({firstName:(null==t?void 0:t.firstName)||"",lastName:(null==t?void 0:t.lastName)||"",email:(null==t?void 0:t.email)||"",role:(null==t?void 0:t.role)||"doctor",bsnr:(null==t?void 0:t.bsnr)||"",lanr:(null==t?void 0:t.lanr)||"",specialization:(null==t?void 0:t.specialization)||"",department:(null==t?void 0:t.department)||"",isActive:(null==t?void 0:t.isActive)??!0}),[l,d]=e.useState(!1),[c,m]=e.useState("");e.useEffect(()=>{t&&o({firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||"",role:t.role||"doctor",bsnr:t.bsnr||"",lanr:t.lanr||"",specialization:t.specialization||"",department:t.department||"",isActive:t.isActive??!0})},[t]);return s&&t?u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:u.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:u.jsxs("div",{className:"mt-3",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User"}),c&&u.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-3",children:u.jsx("p",{className:"text-sm text-red-800",children:c})}),u.jsxs("form",{onSubmit:async e=>{e.preventDefault(),d(!0),m("");try{const e=await g.put(`/users/${t.id}`,n);e.success&&a(e.user)}catch(s){m(s.message)}finally{d(!1)}},className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),u.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:n.firstName,onChange:e=>o({...n,firstName:e.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),u.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:n.lastName,onChange:e=>o({...n,lastName:e.target.value})})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),u.jsx("input",{type:"email",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:n.email,onChange:e=>o({...n,email:e.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),u.jsx("select",{required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:n.role,onChange:e=>o({...n,role:e.target.value}),children:i.map(e=>u.jsx("option",{value:e.value,children:e.key.replace("_"," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())},e.value))})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"BSNR"}),u.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:n.bsnr,onChange:e=>o({...n,bsnr:e.target.value})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"LANR"}),u.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:n.lanr,onChange:e=>o({...n,lanr:e.target.value})})]})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:n.isActive,onChange:e=>o({...n,isActive:e.target.checked})}),u.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"Active User"})]}),u.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[u.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),u.jsx("button",{type:"submit",disabled:l,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:l?"Updating...":"Update User"})]})]})]})})}):null};const N=new class{constructor(){this.metrics=new Map,this.observers=new Map,this.thresholds={LCP:2500,FID:100,CLS:.1,FCP:1800,TTFB:800},this.init()}init(){this.observeWebVitals(),this.observeResourceLoading(),this.observeUserInteractions(),setInterval(()=>this.logMetrics(),3e4)}observeWebVitals(){if("PerformanceObserver"in window){try{const e=new PerformanceObserver(e=>{const s=e.getEntries(),t=s[s.length-1];this.recordMetric("LCP",t.startTime)});e.observe({type:"largest-contentful-paint",buffered:!0}),this.observers.set("LCP",e)}catch(e){}try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this.recordMetric("FID",e.processingStart-e.startTime)})});e.observe({type:"first-input",buffered:!0}),this.observers.set("FID",e)}catch(e){}try{const e=new PerformanceObserver(e=>{let s=0;e.getEntries().forEach(e=>{e.hadRecentInput||(s+=e.value)}),this.recordMetric("CLS",s)});e.observe({type:"layout-shift",buffered:!0}),this.observers.set("CLS",e)}catch(e){}}if(window.performance&&window.performance.getEntriesByType){window.performance.getEntriesByType("paint").forEach(e=>{"first-contentful-paint"===e.name&&this.recordMetric("FCP",e.startTime)})}if(window.performance&&window.performance.timing){const{responseStart:e,navigationStart:s}=window.performance.timing,t=e-s;this.recordMetric("TTFB",t)}}observeResourceLoading(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType?this.recordAPIMetric(e.name,e.duration):"script"===e.initiatorType?this.recordResourceMetric("script",e.duration,e.transferSize):"css"===e.initiatorType?this.recordResourceMetric("css",e.duration,e.transferSize):"img"===e.initiatorType&&this.recordResourceMetric("image",e.duration,e.transferSize)})});e.observe({entryTypes:["resource"]}),this.observers.set("resource",e)}catch(e){}}observeUserInteractions(){let e;document.addEventListener("click",e=>{const s=performance.now();requestAnimationFrame(()=>{const e=performance.now()-s;this.recordMetric("click_response",e)})}),document.addEventListener("scroll",()=>{e||(e=performance.now())},{passive:!0}),document.addEventListener("scrollend",()=>{if(e){const s=performance.now()-e;this.recordMetric("scroll_duration",s),e=null}},{passive:!0})}recordMetric(e,s){this.metrics.has(e)||this.metrics.set(e,[]),this.metrics.get(e).push({value:s,timestamp:Date.now()}),this.thresholds[e]&&this.thresholds[e]}recordAPIMetric(e,s){this.recordMetric("api_response_time",s),this.metrics.has("api_calls")||this.metrics.set("api_calls",new Map);const t=this.metrics.get("api_calls");t.has(e)||t.set(e,[]),t.get(e).push({duration:s,timestamp:Date.now()})}recordResourceMetric(e,s,t){this.recordMetric(`${e}_load_time`,s),t&&this.recordMetric(`${e}_size`,t)}getPerformanceSummary(){const e={};return this.metrics.forEach((s,t)=>{var r;if(Array.isArray(s)){const a=s.slice(-10);e[t]={average:a.reduce((e,s)=>e+s.value,0)/a.length,latest:null==(r=a[a.length-1])?void 0:r.value,count:s.length,max:Math.max(...a.map(e=>e.value)),min:Math.min(...a.map(e=>e.value))}}else s instanceof Map&&(e[t]={},s.forEach((s,r)=>{const a=s.slice(-5);e[t][r]={average:a.reduce((e,s)=>e+s.duration,0)/a.length,count:s.length}}))}),e}logMetrics(){const e=this.getPerformanceSummary();["LCP","FID","CLS","FCP","TTFB"].forEach(s=>{if(e[s]){this.getMetricStatus(s,e[s].latest)}}),e.api_calls&&Object.keys(e.api_calls).length>0&&Object.entries(e.api_calls).forEach(([e,s])=>{}),["script","css","image"].forEach(s=>{e[`${s}_load_time`],e[`${s}_size`]})}getMetricStatus(e,s){if(!this.thresholds[e]||void 0===s)return"";const t=this.thresholds[e];return"CLS"===e?s<=.1?"✅":s<=.25?"⚠️":"❌":s<=t?"✅":s<=1.5*t?"⚠️":"❌"}measureFunction(e,s){return async(...t)=>{const r=performance.now();try{const a=await s(...t),i=performance.now()-r;return this.recordMetric(`function_${e}`,i),a}catch(a){const s=performance.now()-r;throw this.recordMetric(`function_${e}_error`,s),a}}}measureComponentRender(e){return s=>class extends React.Component{componentDidMount(){const s=performance.now();this.startTime&&N.recordMetric(`component_${e}_mount`,s-this.startTime)}componentDidUpdate(){const s=performance.now();this.updateStartTime&&N.recordMetric(`component_${e}_update`,s-this.updateStartTime)}render(){return this.startTime=performance.now(),this.updateStartTime=performance.now(),React.createElement(s,this.props)}}}generateReport(){const e=this.getPerformanceSummary();return{timestamp:(new Date).toISOString(),summary:e,recommendations:this.getRecommendations(e)}}getRecommendations(e){var s,t,r,a,i,n;const o=[];return(null==(s=e.LCP)?void 0:s.latest)>this.thresholds.LCP&&o.push("Improve Largest Contentful Paint by optimizing images and critical resources"),(null==(t=e.FID)?void 0:t.latest)>this.thresholds.FID&&o.push("Reduce First Input Delay by optimizing JavaScript execution"),(null==(r=e.CLS)?void 0:r.latest)>this.thresholds.CLS&&o.push("Improve Cumulative Layout Shift by setting image dimensions and avoiding dynamic content insertion"),(null==(a=e.api_response_time)?void 0:a.average)>1e3&&o.push("Optimize API response times - consider caching or backend optimizations"),(null==(i=e.script_size)?void 0:i.average)>1e5&&o.push("Consider code splitting to reduce JavaScript bundle size"),(null==(n=e.css_size)?void 0:n.average)>5e4&&o.push("Optimize CSS bundle size and remove unused styles"),o}cleanup(){this.observers.forEach(e=>{e.disconnect()}),this.observers.clear()}};class k extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){}render(){return this.state.hasError?u.jsx("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:u.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:u.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),u.jsxs("div",{className:"ml-3",children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Application Error"}),u.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[u.jsx("p",{children:"Something went wrong. Please refresh the page or contact support."}),!1]}),u.jsx("div",{className:"mt-4",children:u.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:null}),window.location.reload()},className:"bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded transition-colors duration-150",children:"Reload Application"})})]})]})})})}):this.props.children}}const C=()=>u.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600 mx-auto"}),u.jsx("p",{className:"mt-4 text-gray-600 text-lg",children:"Loading application..."})]})}),S=({currentUser:e,currentView:s,onViewChange:t,onLogout:r})=>{var a,i,n;const o=[{id:"dashboard",name:"Dashboard",icon:"📊",allowedRoles:["admin","doctor","lab_technician","patient"]},{id:"users",name:"User Management",icon:"👥",allowedRoles:["admin"]}].filter(s=>s.allowedRoles.includes(e.role));return u.jsxs("nav",{className:"bg-white shadow-sm border-b border-gray-200",children:[u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between h-16",children:[u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex-shrink-0 flex items-center",children:u.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Laboratory Results System"})}),u.jsx("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:o.map(e=>u.jsxs("button",{onClick:()=>t(e.id),className:(s===e.id?"border-indigo-500 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300")+" whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-150",children:[u.jsx("span",{className:"mr-2",children:e.icon}),e.name]},e.id))})]}),u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center",children:u.jsxs("span",{className:"text-sm font-medium text-indigo-700",children:[null==(a=e.firstName)?void 0:a.charAt(0),null==(i=e.lastName)?void 0:i.charAt(0)]})})}),u.jsxs("div",{className:"hidden md:block",children:[u.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),u.jsx("div",{className:"text-xs text-gray-500 capitalize",children:null==(n=e.role)?void 0:n.replace("_"," ")})]})]}),u.jsxs("button",{onClick:r,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-150",children:[u.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]})}),u.jsx("div",{className:"sm:hidden",children:u.jsx("div",{className:"pt-2 pb-3 space-y-1",children:o.map(e=>u.jsxs("button",{onClick:()=>t(e.id),className:(s===e.id?"bg-indigo-50 border-indigo-500 text-indigo-700":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50")+" block pl-3 pr-4 py-2 border-l-4 text-base font-medium w-full text-left transition-colors duration-150",children:[u.jsx("span",{className:"mr-2",children:e.icon}),e.name]},e.id))})})]})};function L(){const[s,t]=e.useState(null),[r,a]=e.useState(null),[i,n]=e.useState(!1),[o,l]=e.useState(!0),[d,c]=e.useState(null),[m,x]=e.useState("dashboard");e.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("authToken"),r=localStorage.getItem("userInfo");if(s&&r)try{const e=await g.get("/auth/me");e.success?(t(s),a(e.user),n(!0)):(localStorage.removeItem("authToken"),localStorage.removeItem("userInfo"))}catch(e){localStorage.removeItem("authToken"),localStorage.removeItem("userInfo")}1}catch(e){c("Failed to initialize application")}finally{l(!1)}})()},[]);const h=async()=>{try{await g.post("/auth/logout")}catch(e){}finally{t(null),a(null),n(!1),x("dashboard"),localStorage.removeItem("authToken"),localStorage.removeItem("userInfo"),g.clearCache(),N.recordMetric("user_logout",Date.now())}},f=e=>{c(e.message||"An unexpected error occurred")},b=()=>{c(null)},j=e=>{x(e),N.recordMetric("navigation",Date.now())};return o?u.jsx(k,{children:u.jsx(C,{})}):d?u.jsx(k,{children:u.jsx("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:u.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:u.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),u.jsxs("div",{className:"ml-3",children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Application Error"}),u.jsx("div",{className:"mt-2 text-sm text-red-700",children:u.jsx("p",{children:d})}),u.jsxs("div",{className:"mt-4",children:[u.jsx("button",{onClick:b,className:"bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded mr-2 transition-colors duration-150",children:"Retry"}),u.jsx("button",{onClick:()=>window.location.reload(),className:"bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded transition-colors duration-150",children:"Reload Page"})]})]})]})})})})}):i&&r?u.jsx(k,{children:u.jsxs("div",{className:"App min-h-screen bg-gray-100",children:[u.jsx(S,{currentUser:r,currentView:m,onViewChange:j,onLogout:h}),u.jsx("main",{className:"py-6",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs(e.Suspense,{fallback:u.jsx(C,{}),children:["dashboard"===m&&u.jsx(y,{token:s,currentUser:r,onLogout:h,onError:f}),"users"===m&&"admin"===r.role&&u.jsx(v,{currentUser:r,onError:f})]})})})]})}):u.jsx(k,{children:u.jsx("div",{className:"App",children:u.jsx(e.Suspense,{fallback:u.jsx(C,{}),children:u.jsx(p,{onLoginSuccess:(e,s)=>{t(e),a(s),n(!0),x("dashboard"),g.clearCache(),N.recordMetric("user_login",Date.now())},onError:f})})})})}x.createRoot(document.getElementById("root")).render(u.jsx(t.StrictMode,{children:u.jsx(L,{})}));
