import{r as e,a as t,R as s}from"./vendor-DtX1tuCI.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var r={exports:{}},n={},a=e,o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,c=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function m(e,t,s){var r,n={},a=null,i=null;for(r in void 0!==s&&(a=""+s),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(i=t.ref),t)l.call(t,r)&&!d.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:o,type:e,key:a,ref:i,props:n,_owner:c.current}}n.Fragment=i,n.jsx=m,n.jsxs=m,r.exports=n;var u=r.exports,h={},p=t;function x({onLoginSuccess:t}){const[s,r]=e.useState(""),[n,a]=e.useState(""),[o,i]=e.useState(""),[l,c]=e.useState("");return u.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:u.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[u.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Labor Results Login"}),u.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c("Logging in...");try{const e=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bsnr:s,lanr:n,password:o})}),r=await e.json();e.ok?(c(r.message),t&&t(r.token)):c(r.message||"Login failed")}catch(r){c("Network error or server unavailable.")}},children:[u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"bsnr",className:"block text-gray-700 text-sm font-bold mb-2",children:"BSNR"}),u.jsx("input",{type:"text",id:"bsnr",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:s,onChange:e=>r(e.target.value),required:!0})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"lanr",className:"block text-gray-700 text-sm font-bold mb-2",children:"LANR"}),u.jsx("input",{type:"text",id:"lanr",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:n,onChange:e=>a(e.target.value),required:!0})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{htmlFor:"password",className:"block text-gray-700 text-sm font-bold mb-2",children:"Password"}),u.jsx("input",{type:"password",id:"password",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline",value:o,onChange:e=>i(e.target.value),required:!0})]}),u.jsx("div",{className:"flex items-center justify-between",children:u.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full",children:"Login"})}),l&&u.jsx("p",{className:"text-center mt-4 text-sm",children:l})]})]})})}h.createRoot=p.createRoot,h.hydrateRoot=p.hydrateRoot;const g=s.memo(({status:t})=>{const s=e.useMemo(()=>{switch(t){case"Final":return"bg-green-100 text-green-800";case"Preliminary":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},[t]);return u.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s}`,children:t})}),f=s.memo(({result:e,onDownload:t,downloading:s})=>u.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.id}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.date}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.type}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx(g,{status:e.status})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.patient}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("button",{onClick:()=>t("ldt",e.id),disabled:s,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150",children:s?"Downloading...":"LDT"}),u.jsx("button",{onClick:()=>t("pdf",e.id),disabled:s,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150",children:s?"Downloading...":"PDF"})]})})]}));const b=s.memo(function({token:t,onLogout:s}){const[r,n]=e.useState([]),[a,o]=e.useState(!0),[i,l]=e.useState(""),[c,d]=e.useState(""),[m,h]=e.useState(""),[p,x]=e.useState(""),[g,b]=e.useState(!1),[y,w]=e.useState(1),[v]=e.useState(20),j=e.useMemo(()=>{let e=r;if(i){const t=i.toLowerCase();e=e.filter(e=>e.patient.toLowerCase().includes(t)||e.id.toLowerCase().includes(t)||e.type.toLowerCase().includes(t))}return c&&(e=e.filter(e=>e.status===c)),m&&(e=e.filter(e=>e.type===m)),e},[r,i,c,m]),N=e.useMemo(()=>{const e=(y-1)*v,t=e+v;return j.slice(e,t)},[j,y,v]),S=e.useMemo(()=>Math.ceil(j.length/v),[j.length,v]),C=e.useMemo(()=>[...new Set(r.map(e=>e.status))],[r]),L=e.useMemo(()=>[...new Set(r.map(e=>e.type))],[r]),k=e.useCallback(async()=>{try{o(!0);const e=await fetch("/api/results",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);{const t=await e.json();n(t),x("")}}catch(e){x(e.message||"Network error or server unavailable")}finally{o(!1)}},[t]);e.useEffect(()=>{k()},[k]),e.useEffect(()=>{w(1)},[i,c,m]);const M=e.useCallback(async(e,s=null)=>{var r;try{b(!0);const n=s?`/api/download/${e}/${s}`:`/api/download/${e}`,a=await fetch(n,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error(`Download failed: ${a.statusText}`);const o=await a.blob(),i=window.URL.createObjectURL(o),l=document.createElement("a");l.href=i;const c=a.headers.get("content-disposition"),d=c?null==(r=c.split("filename=")[1])?void 0:r.replace(/"/g,""):`lab_results_${s||"all"}_${(new Date).toISOString().slice(0,10)}.${e}`;l.download=d,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(i)}catch(n){x(`Download failed: ${n.message}`)}finally{b(!1)}},[t]);return p?u.jsx("div",{className:"min-h-screen bg-gray-100 py-6 flex flex-col justify-center sm:py-12",children:u.jsx("div",{className:"relative py-3 sm:max-w-xl sm:mx-auto",children:u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:u.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),u.jsxs("div",{className:"ml-3",children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),u.jsx("div",{className:"mt-2 text-sm text-red-700",children:u.jsx("p",{children:p})}),u.jsx("div",{className:"mt-4",children:u.jsx("button",{onClick:()=>{x(""),k()},className:"bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded transition-colors duration-150",children:"Retry"})})]})]})})})}):u.jsxs("div",{className:"min-h-screen bg-gray-100",children:[u.jsx("div",{className:"bg-white shadow",children:u.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center py-6",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold leading-tight text-gray-900",children:"Laboratory Results Dashboard"}),u.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Showing ",j.length," of ",r.length," results"]})]}),u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsx("button",{onClick:()=>M("ldt"),disabled:g||0===r.length,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150",children:g?"Downloading...":"Download All LDT"}),u.jsx("button",{onClick:()=>M("pdf"),disabled:g||0===r.length,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150",children:g?"Downloading...":"Download All PDF"}),u.jsx("button",{onClick:s,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-150",children:"Logout"})]})]})})}),u.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:u.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:u.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),u.jsx("input",{type:"text",id:"search",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-150",placeholder:"Search by patient name or result ID...",value:i,onChange:e=>l(e.target.value)})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),u.jsxs("select",{id:"status",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-150",value:c,onChange:e=>d(e.target.value),children:[u.jsx("option",{value:"",children:"All Statuses"}),C.map(e=>u.jsx("option",{value:e,children:e},e))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),u.jsxs("select",{id:"type",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-150",value:m,onChange:e=>h(e.target.value),children:[u.jsx("option",{value:"",children:"All Types"}),L.map(e=>u.jsx("option",{value:e,children:e},e))]})]})]})})}),u.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pb-6",children:u.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:a?u.jsx("div",{className:"flex items-center justify-center h-64",children:u.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[u.jsx("thead",{className:"bg-gray-50",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Result ID"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),u.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(e=>u.jsx(f,{result:e,onDownload:M,downloading:g},e.id))})]})}),S>1&&u.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[u.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[u.jsx("button",{onClick:()=>w(Math.max(1,y-1)),disabled:1===y,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),u.jsx("button",{onClick:()=>w(Math.min(S,y+1)),disabled:y===S,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),u.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[u.jsx("div",{children:u.jsxs("p",{className:"text-sm text-gray-700",children:["Showing"," ",u.jsx("span",{className:"font-medium",children:(y-1)*v+1})," ","to"," ",u.jsx("span",{className:"font-medium",children:Math.min(y*v,j.length)})," ","of"," ",u.jsx("span",{className:"font-medium",children:j.length})," ","results"]})}),u.jsx("div",{children:u.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[u.jsx("button",{onClick:()=>w(Math.max(1,y-1)),disabled:1===y,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),Array.from({length:Math.min(5,S)},(e,t)=>{const s=Math.max(1,Math.min(S-4,y-2))+t;return u.jsx("button",{onClick:()=>w(s),className:"relative inline-flex items-center px-4 py-2 border text-sm font-medium "+(s===y?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:s},s)}),u.jsx("button",{onClick:()=>w(Math.min(S,y+1)),disabled:y===S,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})})]})]})]})})})]})});const y=new class{constructor(){this.baseURL="/api",this.cache=new Map,this.requestInterceptors=[],this.responseInterceptors=[],this.defaultOptions={headers:{"Content-Type":"application/json"}}}addRequestInterceptor(e){this.requestInterceptors.push(e)}addResponseInterceptor(e){this.responseInterceptors.push(e)}async applyRequestInterceptors(e,t){let s={...t};for(const r of this.requestInterceptors)s=await r(e,s);return s}async applyResponseInterceptors(e){let t=e;for(const s of this.responseInterceptors)t=await s(t);return t}getCacheKey(e,t){return`${t.method||"GET"}-${e}-${JSON.stringify(t.body||{})}`}async retry(e,t=3,s=1e3){try{return await e()}catch(r){if(t>0&&r.status>=500)return await new Promise(e=>setTimeout(e,s)),this.retry(e,t-1,2*s);throw r}}async request(e,t={}){const s=`${this.baseURL}${e}`,r={...this.defaultOptions,...t,headers:{...this.defaultOptions.headers,...t.headers}},n=await this.applyRequestInterceptors(s,r),a=this.getCacheKey(s,n);if("GET"===n.method||!n.method){const e=this.cache.get(a);if(e&&Date.now()-e.timestamp<(n.cacheTimeout||3e5))return e.data}const o=await this.retry(async()=>{const e=await fetch(s,n);if(!e.ok){const t=new Error(`HTTP error! status: ${e.status}`);throw t.status=e.status,t.response=e,t}return e}),i=await this.applyResponseInterceptors(o);let l;const c=i.headers.get("content-type");return l=(null==c?void 0:c.includes("application/json"))?await i.json():await i.text(),"GET"!==n.method&&n.method||this.cache.set(a,{data:l,timestamp:Date.now()}),l}get(e,t={}){return this.request(e,{...t,method:"GET"})}post(e,t,s={}){return this.request(e,{...s,method:"POST",body:JSON.stringify(t)})}put(e,t,s={}){return this.request(e,{...s,method:"PUT",body:JSON.stringify(t)})}delete(e,t={}){return this.request(e,{...t,method:"DELETE"})}async download(e,t={}){const s=`${this.baseURL}${e}`,r=await this.applyRequestInterceptors(s,{...this.defaultOptions,...t}),n=await fetch(s,r);if(!n.ok){const e=new Error(`Download failed: ${n.status}`);throw e.status=n.status,e}return n}clearCache(){this.cache.clear()}clearCacheEntry(e,t={}){const s=this.getCacheKey(`${this.baseURL}${e}`,t);this.cache.delete(s)}};y.addRequestInterceptor(async(e,t)=>{const s=localStorage.getItem("authToken");return s&&(t.headers.Authorization=`Bearer ${s}`),t}),y.addResponseInterceptor(async e=>(401===e.status&&(localStorage.removeItem("authToken"),window.location.href="/login"),e));const w=new class{constructor(){this.metrics=new Map,this.observers=new Map,this.thresholds={LCP:2500,FID:100,CLS:.1,FCP:1800,TTFB:800},this.init()}init(){this.observeWebVitals(),this.observeResourceLoading(),this.observeUserInteractions(),setInterval(()=>this.logMetrics(),3e4)}observeWebVitals(){if("PerformanceObserver"in window){try{const e=new PerformanceObserver(e=>{const t=e.getEntries(),s=t[t.length-1];this.recordMetric("LCP",s.startTime)});e.observe({type:"largest-contentful-paint",buffered:!0}),this.observers.set("LCP",e)}catch(e){}try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this.recordMetric("FID",e.processingStart-e.startTime)})});e.observe({type:"first-input",buffered:!0}),this.observers.set("FID",e)}catch(e){}try{const e=new PerformanceObserver(e=>{let t=0;e.getEntries().forEach(e=>{e.hadRecentInput||(t+=e.value)}),this.recordMetric("CLS",t)});e.observe({type:"layout-shift",buffered:!0}),this.observers.set("CLS",e)}catch(e){}}if(window.performance&&window.performance.getEntriesByType){window.performance.getEntriesByType("paint").forEach(e=>{"first-contentful-paint"===e.name&&this.recordMetric("FCP",e.startTime)})}if(window.performance&&window.performance.timing){const{responseStart:e,navigationStart:t}=window.performance.timing,s=e-t;this.recordMetric("TTFB",s)}}observeResourceLoading(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType?this.recordAPIMetric(e.name,e.duration):"script"===e.initiatorType?this.recordResourceMetric("script",e.duration,e.transferSize):"css"===e.initiatorType?this.recordResourceMetric("css",e.duration,e.transferSize):"img"===e.initiatorType&&this.recordResourceMetric("image",e.duration,e.transferSize)})});e.observe({entryTypes:["resource"]}),this.observers.set("resource",e)}catch(e){}}observeUserInteractions(){let e;document.addEventListener("click",e=>{const t=performance.now();requestAnimationFrame(()=>{const e=performance.now()-t;this.recordMetric("click_response",e)})}),document.addEventListener("scroll",()=>{e||(e=performance.now())},{passive:!0}),document.addEventListener("scrollend",()=>{if(e){const t=performance.now()-e;this.recordMetric("scroll_duration",t),e=null}},{passive:!0})}recordMetric(e,t){this.metrics.has(e)||this.metrics.set(e,[]),this.metrics.get(e).push({value:t,timestamp:Date.now()}),this.thresholds[e]&&this.thresholds[e]}recordAPIMetric(e,t){this.recordMetric("api_response_time",t),this.metrics.has("api_calls")||this.metrics.set("api_calls",new Map);const s=this.metrics.get("api_calls");s.has(e)||s.set(e,[]),s.get(e).push({duration:t,timestamp:Date.now()})}recordResourceMetric(e,t,s){this.recordMetric(`${e}_load_time`,t),s&&this.recordMetric(`${e}_size`,s)}getPerformanceSummary(){const e={};return this.metrics.forEach((t,s)=>{var r;if(Array.isArray(t)){const n=t.slice(-10);e[s]={average:n.reduce((e,t)=>e+t.value,0)/n.length,latest:null==(r=n[n.length-1])?void 0:r.value,count:t.length,max:Math.max(...n.map(e=>e.value)),min:Math.min(...n.map(e=>e.value))}}else t instanceof Map&&(e[s]={},t.forEach((t,r)=>{const n=t.slice(-5);e[s][r]={average:n.reduce((e,t)=>e+t.duration,0)/n.length,count:t.length}}))}),e}logMetrics(){const e=this.getPerformanceSummary();["LCP","FID","CLS","FCP","TTFB"].forEach(t=>{if(e[t]){this.getMetricStatus(t,e[t].latest)}}),e.api_calls&&Object.keys(e.api_calls).length>0&&Object.entries(e.api_calls).forEach(([e,t])=>{}),["script","css","image"].forEach(t=>{e[`${t}_load_time`],e[`${t}_size`]})}getMetricStatus(e,t){if(!this.thresholds[e]||void 0===t)return"";const s=this.thresholds[e];return"CLS"===e?t<=.1?"✅":t<=.25?"⚠️":"❌":t<=s?"✅":t<=1.5*s?"⚠️":"❌"}measureFunction(e,t){return async(...s)=>{const r=performance.now();try{const n=await t(...s),a=performance.now()-r;return this.recordMetric(`function_${e}`,a),n}catch(n){const t=performance.now()-r;throw this.recordMetric(`function_${e}_error`,t),n}}}measureComponentRender(e){return t=>class extends React.Component{componentDidMount(){const t=performance.now();this.startTime&&w.recordMetric(`component_${e}_mount`,t-this.startTime)}componentDidUpdate(){const t=performance.now();this.updateStartTime&&w.recordMetric(`component_${e}_update`,t-this.updateStartTime)}render(){return this.startTime=performance.now(),this.updateStartTime=performance.now(),React.createElement(t,this.props)}}}generateReport(){const e=this.getPerformanceSummary();return{timestamp:(new Date).toISOString(),summary:e,recommendations:this.getRecommendations(e)}}getRecommendations(e){var t,s,r,n,a,o;const i=[];return(null==(t=e.LCP)?void 0:t.latest)>this.thresholds.LCP&&i.push("Improve Largest Contentful Paint by optimizing images and critical resources"),(null==(s=e.FID)?void 0:s.latest)>this.thresholds.FID&&i.push("Reduce First Input Delay by optimizing JavaScript execution"),(null==(r=e.CLS)?void 0:r.latest)>this.thresholds.CLS&&i.push("Improve Cumulative Layout Shift by setting image dimensions and avoiding dynamic content insertion"),(null==(n=e.api_response_time)?void 0:n.average)>1e3&&i.push("Optimize API response times - consider caching or backend optimizations"),(null==(a=e.script_size)?void 0:a.average)>1e5&&i.push("Consider code splitting to reduce JavaScript bundle size"),(null==(o=e.css_size)?void 0:o.average)>5e4&&i.push("Optimize CSS bundle size and remove unused styles"),i}cleanup(){this.observers.forEach(e=>{e.disconnect()}),this.observers.clear()}};class v extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){return this.state.hasError?u.jsx("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:u.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:u.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),u.jsxs("div",{className:"ml-3",children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Application Error"}),u.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[u.jsx("p",{children:"Something went wrong. Please refresh the page or contact support."}),!1]}),u.jsx("div",{className:"mt-4",children:u.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:null}),window.location.reload()},className:"bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded transition-colors duration-150",children:"Reload Application"})})]})]})})})}):this.props.children}}const j=()=>u.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600 mx-auto"}),u.jsx("p",{className:"mt-4 text-gray-600 text-lg",children:"Loading application..."})]})});function N(){const[t,s]=e.useState(null),[r,n]=e.useState(!1),[a,o]=e.useState(!0),[i,l]=e.useState(null);e.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("authToken");if(t)try{await y.get("/health"),s(t),n(!0)}catch(e){localStorage.removeItem("authToken")}1}catch(e){l("Failed to initialize application")}finally{o(!1)}})()},[]);const c=e=>{l(e.message||"An unexpected error occurred")},d=()=>{l(null)};return a?u.jsx(v,{children:u.jsx(j,{})}):i?u.jsx(v,{children:u.jsx("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:u.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex-shrink-0",children:u.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:u.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),u.jsxs("div",{className:"ml-3",children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Application Error"}),u.jsx("div",{className:"mt-2 text-sm text-red-700",children:u.jsx("p",{children:i})}),u.jsxs("div",{className:"mt-4",children:[u.jsx("button",{onClick:d,className:"bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded mr-2 transition-colors duration-150",children:"Retry"}),u.jsx("button",{onClick:()=>window.location.reload(),className:"bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded transition-colors duration-150",children:"Reload Page"})]})]})]})})})})}):u.jsx(v,{children:u.jsx("div",{className:"App",children:u.jsx(e.Suspense,{fallback:u.jsx(j,{}),children:r?u.jsx(b,{token:t,onLogout:()=>{s(null),n(!1),localStorage.removeItem("authToken"),y.clearCache(),w.recordMetric("user_logout",Date.now())},onError:c}):u.jsx(x,{onLoginSuccess:e=>{s(e),n(!0),localStorage.setItem("authToken",e),y.clearCache(),w.recordMetric("user_login",Date.now())},onError:c})})})})}h.createRoot(document.getElementById("root")).render(u.jsx(s.StrictMode,{children:u.jsx(N,{})}));
